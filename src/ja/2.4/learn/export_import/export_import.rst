=======================
エクスポート/インポート
=======================

| 本シナリオでは、簡単な例として、登録したデータをエクスポート/インポートすることを題材に Exastro IT Automation の基本操作を学習します。

事前準備
========

| 事前準備では、エクスポートするデータの登録をしていきます。
| work01 ワークスペースをエクスポート元のワークスペースとし、work02 ワークスペースをインポート先のワークスペースとして進めていきます。

.. list-table:: ワークスペース概要
   :widths: 10 10
   :header-rows: 1

   * - エクスポート元ワークスペース
     - インポート先ワークスペース
   * - :kbd:`work01`
     - :kbd:`work02`

パラメータシートの作成
----------------------

| まずは work01 ワークスペースでの作業になります。

| データをエクスポートするためにパラメータシートを作成していきましょう。
| :menuselection:`パラメータシート作成 --> パラメータシート定義・作成` から、「ディレクトリ設定」というパラメータシートを作成します。

.. figure:: /images/learn/quickstart/export_import/パラメータシート作成定義.png
   :width: 1200px
   :alt: パラメータシート作成

.. list-table:: パラメータシート作成の項目の設定値1
   :widths: 10 10 10 10 10
   :header-rows: 1

   * - 設定項目
     - 項目1設定値
     - 項目2設定値
     - 項目3設定値
     - 項目4設定値
   * - 項目の名前
     - :kbd:`パス`
     - :kbd:`所有者`
     - :kbd:`グループ`
     - :kbd:`モード`
   * - 項目の名前(Rest API用) 
     - :kbd:`path`
     - :kbd:`owner`
     - :kbd:`group`
     - :kbd:`mode`
   * - 入力方式
     - :kbd:`文字列(単一行)`
     - :kbd:`文字列(単一行)`
     - :kbd:`文字列(単一行)`
     - :kbd:`文字列(単一行)`
   * - 選択項目
     - :kbd:`64`
     - :kbd:`64`
     - :kbd:`64`
     - :kbd:`64`
   * - 正規表現
     - 
     - 
     - 
     - 
   * - 初期値
     - 
     - 
     - 
     - 
   * - 必須
     - 
     - 
     - 
     - 
   * - 一意制約
     - 
     - 
     - 
     - 
   * - 説明
     - 
     - 
     - 
     - 
   * - 備考
     - 
     - 
     - 
     - 

.. list-table:: パラメータシート作成情報の設定値
   :widths: 5 10
   :header-rows: 1

   * - 項目名
     - 設定値
   * - 項番
     - (自動入力)
   * - パラメータシート名
     - :kbd:`ディレクトリ設定`
   * - パラメータシート名(REST)
     - :kbd:`directory_settings`
   * - 作成対象
     - :kbd:`パラメータシート（ホスト/オペレーションあり）`
   * - 表示順序
     - :kbd:`1`
   * - バンドル利用
     - 「利用する」にチェックを入れない(無効)
   * - 最終更新日時
     - (自動入力)
   * - 最終更新者
     - (自動入力)

機器登録
--------

| 作業対象となるサーバを機器一覧に登録します。

| :menuselection:`Ansible共通 --> 機器一覧` から、作業対象であるサーバーの接続情報を登録します。

.. figure:: /images/learn/quickstart/export_import/機器一覧登録設定.gif
   :width: 1200px
   :alt: 機器一覧登録

.. list-table:: 機器一覧の設定値
   :widths: 10 10 15 10 10 10
   :header-rows: 3

   * - HW機器種別
     - ホスト名
     - IPアドレス
     - ログインパスワード
     - ssh鍵認証情報
     - Ansible利用情報
   * - 
     - 
     - 
     - ユーザ
     - ssh秘密鍵ファイル
     - Legacy/Role利用情報
   * - 
     - 
     - 
     - 
     - 
     - 認証方式
   * - :kbd:`SV`
     - :kbd:`server01`
     - :kbd:`192.168.0.1 ※適切なIPアドレスを設定`
     - :kbd:`接続ユーザ名`
     - :kbd:`(秘密鍵ファイル)`
     - :kbd:`鍵認証(パスフレーズなし)`

.. tip::
   | 今回のシナリオでは鍵認証で実行しますが、パスワード認証での実行も可能です。
   | 認証方式は、作業対象サーバーへのログインの方法に応じて適宜変更してください。

作業概要登録
------------

| オペレーション登録では、作業を実施する際の作業概要を定義します。

.. glossary:: オペレーション
   実施する作業のことで、オペレーションに対して作業対象とパラメータが紐づきます。

| :menuselection:`基本コンソール --> オペレーション一覧` から、作業実施日時や作業名を登録します。

.. figure:: /images/learn/quickstart/export_import/オペレーション登録.png
   :width: 1200px
   :alt: オペレーション登録

.. list-table:: オペレーション登録内容
   :widths: 10 10
   :header-rows: 1

   * - オペレーション名
     - 実施予定日時
   * - :kbd:`OP1`
     - :kbd:`2024/04/01 12:00:00`
   * - :kbd:`OP2`
     - :kbd:`2024/04/02 12:00:00`
   * - :kbd:`OP3`
     - :kbd:`2024/04/03 12:00:00`

パラメータ設定
--------------

| :menuselection:`入力用 --> ディレクトリ設定` から、ディレクトリ設定のパラメータを登録します。

.. figure:: /images/learn/quickstart/export_import/パラメータ入力1.png
   :width: 1200px
   :alt: ディレクトリ設定のパラメータ登録

.. list-table:: ディレクトリ設定の設定値1
  :widths: 5 15 5 5 5 5
  :header-rows: 2

  * - ホスト名
    - オペレーション
    - パラメータ
    -
    -
    -
  * - 
    - オペレーション名
    - パス
    - 所有者
    - グループ
    - モード
  * - :kbd:`server01`
    - :kbd:`2024/04/01 12:00:00_OP1`
    - :kbd:`/tmp/work1`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
  * - :kbd:`server01`
    - :kbd:`2024/04/02 12:00:00_OP2`
    - :kbd:`/tmp/work2`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`

環境移行エクスポート/インポート
===============================

| エクスポート/インポートには、環境移行と時刻指定とExcel一括の3つのモードがあります。
| 詳しくは :doc:`../../../manuals/export_import/menu_export_import` を参照してください。
| まずは、環境移行モードで実行します。

メニューエクスポートの実行
--------------------------

| それでは作成したメニューをエクスポートします。
| :menuselection:`エクスポート/インポート --> メニューエクスポート` からメニューのエクスポートをします。

.. figure:: /images/learn/quickstart/export_import/環境移行メニューエクスポート.gif
   :width: 1200px
   :alt: 環境移行メニューエクスポート

.. list-table:: 環境移行メニューエクスポート
  :widths: 5 5 10
  :header-rows: 1

  * - モード
    - 廃止情報
    - エクスポートメニュー選択
  * - :kbd:`環境移行`
    - :kbd:`廃止を含む`
    - :kbd:`全てのメニュー`

kymファイルのダウンロード
-------------------------

| 実行したエクスポートのデータをダウンロードしましょう。
| :menuselection:`エクスポート/インポート --> メニューエクスポート・インポート管理 --> フィルタ --> ファイル名` からkymファイルをダウンロードします。

.. figure:: /images/learn/quickstart/export_import/環境移行ファイルダウンロード.gif
   :width: 1200px
   :alt: 環境移行kymファイルダウンロード

メニューインポートの実行
------------------------

| ここからは work02 ワークスペースでの作業になります。

| ダウンロードしたkymファイルをインポートします。
| :menuselection:`エクスポート/インポート --> メニューインポート --> ファイル選択` からエクスポートしたkymファイルをアップロードします。インポートメニュー選択は、全てのメニューを選択します。

.. figure:: /images/learn/quickstart/export_import/環境移行メニューインポート.gif
   :width: 1200px
   :alt: 環境移行メニューインポート

メニューインポートの確認
------------------------

| メニューインポートの実行が完了したら、実行したメニューインポートの情報を確認します。
| :menuselection:`エクスポート/インポート --> メニューエクスポート・インポート管理 --> フィルタ` から実行したインポートのステータスが「完了」となっていることを確認しましょう。

.. figure:: /images/learn/quickstart/export_import/環境移行メニューインポート確認.png
   :width: 1200px
   :alt: 環境移行メニューインポート確認

| 次に移行されたメニューを確認します。
| :menuselection:`入力用 --> ディレクトリ設定 --> フィルタ` から、ディレクトリ設定の最終更新者が「メニューエクスポート・インポート機能」となっていることを確認しましょう。

.. figure:: /images/learn/quickstart/export_import/環境移行メニューインポート確認2.gif
   :width: 1200px
   :alt: 環境移行メニューインポート確認

.. list-table:: 環境移行メニューインポート確認
  :widths: 5 10 5 5 5 5 10
  :header-rows: 2

  * - ホスト名
    - オペレーション
    - パラメータ
    -
    -
    -
    - 最終更新者
  * - 
    - オペレーション名
    - パス
    - 所有者
    - グループ
    - モード
    - 
  * - :kbd:`server01`
    - :kbd:`2024/04/01 12:00:00_OP1`
    - :kbd:`/tmp/work1`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
    - :kbd:`メニューエクスポート・インポート機能`
  * - :kbd:`server01`
    - :kbd:`2024/04/02 12:00:00_OP2`
    - :kbd:`/tmp/work2`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
    - :kbd:`メニューエクスポート・インポート機能`

時刻指定エクスポート/インポート
===============================

| 次に時刻指定モードで実行します。
| 詳しくは :doc:`../../../manuals/export_import/menu_export_import` を参照してください。

パラメータ更新
--------------

| ここからは work01 ワークスペースでの作業となります。

| 次にエクスポート元のデータをパラメータを更新します。
| :menuselection:`入力用 --> ディレクトリ設定 --> フィルタ` から、更新したいパラメータを選択し、編集を押下します。
| 今回は時刻指定モードでエクスポートを行うため、OP1のパラメータ更新後、2~3分程度時間を空けてからOP2の更新を行ってください。パラメータの更新後、:menuselection:`入力用 --> ディレクトリ設定 --> フィルタ` からOP2の最終更新日時を確認しておきましょう。

.. figure:: /images/learn/quickstart/export_import/パラメータ更新2.gif
   :width: 1200px
   :alt: ディレクトリ設定のパラメータ更新

.. figure:: /images/learn/quickstart/export_import/パラメータ更新3.gif
   :width: 1200px
   :alt: ディレクトリ設定のパラメータ更新

.. list-table:: ディレクトリ設定の設定値2
  :widths: 5 15 5 5 5 5
  :header-rows: 2

  * - ホスト名
    - オペレーション
    - パラメータ
    - 
    - 
    - 
  * - 
    - オペレーション名
    - パス
    - 所有者
    - グループ
    - モード
  * - :kbd:`server01`
    - :kbd:`2024/04/01 12:00:00_OP1`
    - :kbd:`/tmp/work11`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
  * - :kbd:`server01`
    - :kbd:`2024/04/02 12:00:00_OP2`
    - :kbd:`/tmp/work22`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`

パラメータ登録
--------------

| 次に新しくパラメータを登録します。
| :menuselection:`入力用 --> ディレクトリ設定` から、ディレクトリ設定のパラメータを登録します。

.. figure:: /images/learn/quickstart/export_import/パラメータ登録4.png
   :width: 1200px
   :alt: ディレクトリ設定のパラメータ登録

.. list-table:: ディレクトリ設定の設定値3
  :widths: 5 15 5 5 5 5
  :header-rows: 2

  * - ホスト名
    - オペレーション
    - パラメータ
    -
    -
    -
  * - 
    - オペレーション名
    - パス
    - 所有者
    - グループ
    - モード
  * - :kbd:`server01`
    - :kbd:`2024/04/03 12:00:00_OP3`
    - :kbd:`/tmp/work3`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`

メニューエクスポートの実行
--------------------------

| それでは更新したメニューをエクスポートします。
| :menuselection:`エクスポート/インポート --> メニューエクスポート` からメニューのエクスポートをします。

.. figure:: /images/learn/quickstart/export_import/時刻指定メニューエクスポート1.gif
   :width: 1200px
   :alt: 時刻指定メニューエクスポート

.. list-table:: 時刻指定メニューエクスポート
  :widths: 5 10 5 10
  :header-rows: 1

  * - モード
    - yyyy/MM/dd HH:mm
    - 廃止情報
    - エクスポートメニュー選択
  * - :kbd:`時刻指定`
    - :kbd:`OP2のデータ更新日時`
    - :kbd:`廃止を含む`
    - :kbd:`全てのメニュー`

.. tip::
   | 時刻指定の際は、OP2のデータ更新日時を指定しましょう。時刻指定で指定した時刻以降のデータがエクスポートされます。

kymファイルのダウンロード
-------------------------

| 実行したエクスポートのデータをダウンロードしましょう。
| :menuselection:`エクスポート/インポート --> メニューエクスポート・インポート管理 --> フィルタ --> ファイル名` からkymファイルをダウンロードします。

.. figure:: /images/learn/quickstart/export_import/時刻指定ファイルダウンロード1.gif
   :width: 1200px
   :alt: 時刻指定kymファイルダウンロード

メニューインポートの実行
------------------------

| ここからは work02 ワークスペースでの作業になります。

| ダウンロードしたkymファイルをインポートします。
| :menuselection:`エクスポート/インポート --> メニューインポート --> ファイル選択` からエクスポートしたkymファイルをアップロードします。インポートメニュー選択は、全てのメニューを選択します。

.. figure:: /images/learn/quickstart/export_import/時刻指定メニューインポート1.gif
   :width: 1200px
   :alt: 時刻指定メニューインポート

メニューインポートの確認
------------------------

| メニューインポートの実行が完了したら、実行したメニューインポートの情報を確認します。
| :menuselection:`エクスポート/インポート --> メニューエクスポート・インポート管理 --> フィルタ` から実行したインポートのステータスが「完了」となっていることを確認しましょう。

.. figure:: /images/learn/quickstart/export_import/時刻指定メニューインポート確認1.png
   :width: 1200px
   :alt: 時刻指定メニューインポート確認

| 次に移行されたメニューを確認します。
| :menuselection:`入力用 --> ディレクトリ設定 --> フィルタ` から、時刻指定以降のパラメータが登録、更新されていることを確認しましょう。OP1のデータが更新されておらず、OP2のデータが更新、OP3のデータが登録されていれば大丈夫です。

.. figure:: /images/learn/quickstart/export_import/時刻指定メニューインポート確認1.gif
   :width: 1200px
   :alt: 時刻指定メニューインポート確認

.. list-table:: 時刻指定メニューインポート確認
  :widths: 5 10 5 5 5 5 10
  :header-rows: 2

  * - ホスト名
    - オペレーション
    - パラメータ
    - 
    - 
    -
    - 最終更新者
  * - 
    - オペレーション名
    - パス
    - 所有者
    - グループ
    - モード
    - 
  * - :kbd:`server01`
    - :kbd:`2024/04/01 12:00:00_OP1`
    - :kbd:`/tmp/work1`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
    - :kbd:`メニューエクスポート・インポート機能`
  * - :kbd:`server01`
    - :kbd:`2024/04/02 12:00:00_OP2`
    - :kbd:`/tmp/work22`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
    - :kbd:`メニューエクスポート・インポート機能`
  * - :kbd:`server01`
    - :kbd:`2024/04/03 12:00:00_OP3`
    - :kbd:`/tmp/work3`
    - :kbd:`root`
    - :kbd:`root`
    - :kbd:`0644`
    - :kbd:`メニューエクスポート・インポート機能`

Excel一括エクスポート/インポート
================================

| 次にExcel一括モードで実行します。
| 詳しくは :doc:`../../../manuals/export_import/excel_export_import` を参照してください。

Excel一括エクスポートの実行
---------------------------

| ここからは work01 ワークスペースでの作業となります。

| それではメニューをエクスポートします。
| :menuselection:`エクスポート/インポート --> Excel一括エクスポート` からメニューのエクスポートをします。

.. figure:: /images/learn/quickstart/export_import/Excel一括メニューエクスポート1.gif
   :width: 1200px
   :alt: Excel一括メニューエクスポート

.. list-table:: Excel一括メニューエクスポート
  :widths: 5 5
  :header-rows: 1

  * - 廃止情報
    - エクスポートメニュー選択
  * - :kbd:`全レコード`
    - :kbd:`全てのメニュー`

zipファイルのダウンロード
-------------------------

| 実行したエクスポートのデータをダウンロードしましょう。
| :menuselection:`エクスポート/インポート --> Excel一括エクスポート・インポート管理 --> フィルタ --> ファイル名` からzipファイルをダウンロードします。

.. figure:: /images/learn/quickstart/export_import/Excel一括zipファイルダウンロード1.gif
   :width: 1200px
   :alt: Excel一括zipファイルダウンロード

Excelファイルの編集
-------------------

| zipファイルダウンロード後、ファイルを解凍しましょう。本シナリオでは、Excel一括エクスポート機能を使用し、オペレーション一覧へ新たなオペレーションの登録処理を行います。
| 解凍したファイル、:menuselection:`基本コンソール --> オペレーション一覧` を開き、ファイルを以下のように編集し、上書き保存します。

.. figure:: /images/learn/quickstart/export_import/Excel一括ファイル編集.png
   :width: 1200px
   :alt: Excel一括ファイル編集

.. list-table:: Excelファイル編集
  :widths: 5 5 10
  :header-rows: 1

  * - 実行処理種別
    - オペレーション名
    - 実施予定日時
  * - :kbd:`登録`
    - :kbd:`OP4`
    - :kbd:`2024/04/04 12:00:00`
  * - :kbd:`登録`
    - :kbd:`OP5`
    - :kbd:`2024/04/05 12:00:00`
  * - :kbd:`登録`
    - :kbd:`OP6`
    - :kbd:`2024/04/06 12:00:00`

| その後、エクスポートした全てのファイルを選択し、zipファイルに圧縮します。zipファイル名は任意のファイル名で大丈夫です。

.. figure:: /images/learn/quickstart/export_import/Excelファイルzip.gif
   :width: 1200px
   :alt: Excelファイルzip方法

Excel一括インポートの実行
-------------------------

| ここからは work02 ワークスペースでの作業になります。

| 圧縮したzipファイルをインポートします。
| :menuselection:`エクスポート/インポート --> Excel一括インポート --> ファイル選択` からエクスポートしたzipファイルをアップロードします。インポートメニュー選択は、全てのメニューを選択します。

.. figure:: /images/learn/quickstart/export_import/Excel一括インポート1.gif
   :width: 1200px
   :alt: Excel一括インポート

Excel一括インポートの確認
-------------------------

| メニューインポートの実行が完了したら、実行したメニューインポートの情報を確認します。
| :menuselection:`エクスポート/インポート --> Excel一括エクスポート・インポート管理 --> フィルタ` から実行したインポートのステータスが「完了」となっていることを確認しましょう。
| そして、:menuselection:`エクスポート/インポート --> Excel一括エクスポート・インポート管理 --> フィルタ --> 結果` から結果logファイルをダウンロードします。ダウンロードしたlogファイルを開き、登録件数を確認しましょう。

.. figure:: /images/learn/quickstart/export_import/Excel一括インポート確認1.gif
   :width: 1200px
   :alt: Excel一括インポート確認

.. figure:: /images/learn/quickstart/export_import/Excel一括インポート確認2.png
   :width: 1200px
   :alt: Excel一括インポート確認

| 次に、ファイルを編集して登録した内容を確認します。
| :menuselection:`基本コンソール --> オペレーション一覧 --> フィルタ` から登録したオペレーションが追加されていることを確認しましょう。

.. figure:: /images/learn/quickstart/export_import/Excel一括インポート確認2.gif
   :width: 1200px
   :alt: Excel一括インポート確認

.. list-table:: Excel一括インポート確認
   :widths: 5 5 10
   :header-rows: 1

   * - オペレーション名
     - 実施予定日時
     - 最終更新者
   * - :kbd:`OP1`
     - :kbd:`2024/04/01 12:00:00`
     - :kbd:`メニューエクスポート・インポート機能`
   * - :kbd:`OP2`
     - :kbd:`2024/04/02 12:00:00`
     - :kbd:`メニューエクスポート・インポート機能`
   * - :kbd:`OP3`
     - :kbd:`2024/04/03 12:00:00`
     - :kbd:`メニューエクスポート・インポート機能`
   * - :kbd:`OP4`
     - :kbd:`2024/04/04 12:00:00`
     - :kbd:`User名`
   * - :kbd:`OP5`
     - :kbd:`2024/04/05 12:00:00`
     - :kbd:`User名`
   * - :kbd:`OP6`
     - :kbd:`2024/04/06 12:00:00`
     - :kbd:`User名`

まとめ
======

| 本シナリオでは、パラメータシートやオペレーションを作成し、それらを別のワークスペースに移行するというシナリオでエクスポート/インポート機能を学習しました。
| エクスポート/インポート機能を使うと、新たにワークスペースを作成し、既存のデータを簡単に新たに作成したワークスペースへ移行することが出来ます。
| より詳細な情報を知りたい場合は、:doc:`../../../manuals/index` を参照してください。